<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Coach</title>
  <style>
    body { background: #111; color: #eee; text-align: center; font-family: sans-serif; }
    img { max-width: 90%; border: 4px solid #444; border-radius: 10px; margin-top: 20px; }
    select, button { margin: 10px; padding: 8px; font-size: 1rem; }
    video {
      width: 100%;          /* fills the container */
      max-width: 1200px;    /* limit to 1200px wide */
      height: auto;         /* preserve aspect ratio */
    }
  </style>
</head>
<body>
  <h1>AI Coach</h1>
  <form id="settings" onsubmit="event.preventDefault(); applySettings();">
    <label for="exercise">Choose exercise:</label>
    <select id="exercise">
      <option value="squat">Squat</option>
      <option value="pushup">Push-up</option>
      <option value="lunge">Lunge</option>
    </select>
    <button type="submit">Start</button>
  </form>

  <div id="status">⚙️ Waiting for selection...</div>

  <img id="video" style="display:none;" />

  <script>
    async function applySettings() {
      const exercise = document.getElementById("exercise").value;

      try {
        const res = await fetch(`http://localhost:8000/set_config?exercise=${exercise}`);
        const data = await res.json();

        if (data.status === "ok") {
          document.getElementById("status").innerText =
            `✅ Config set: ${data.exercise}`;

          // refresh video stream (cache-bust with timestamp)
          const videoEl = document.getElementById("video");
          videoEl.src = "http://localhost:8000/video?" + new Date().getTime();
          videoEl.style.display = "block";
        } else {
          document.getElementById("status").innerText = "❌ " + data.msg;
        }
      } catch (err) {
        document.getElementById("status").innerText = "❌ Failed to connect to backend.";
      }
    }
  </script>
</body>
</html>
